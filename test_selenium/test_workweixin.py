# Generated by Selenium IDE
import shelve
from time import sleep

import pytest

from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By

'''
selenium IDE录制的代码：
1.代码冗余
2.还需要添加断言
'''


class TestWorkweixin():
    def setup_method(self, method):
        # 复用浏览器
        # option = Options()
        # option.debugger_address = "localhost:9222"
        # self.driver = webdriver.Chrome(options=option)
        self.driver = webdriver.Chrome()
        # 隐式等待
        self.driver.implicitly_wait(5)

    def teardown_method(self, method):
        self.driver.quit()

    def test_contact(self):
        sleep(3)
        self.driver.get("https://work.weixin.qq.com/wework_admin/frame#index")
        self.driver.find_element(By.ID, "menu_contacts").click()
        # 断言
        myclass = self.driver.find_element(By.ID, "menu_contacts").get_attribute("class")
        # print("myclass")
        assert 'frame_nav_item frame_nav_item_Curr' == myclass

    def test_cookies(self):
        sleep(3)
        # cookies = self.driver.get_cookies()
        # print(cookies)

        self.driver.get("https://work.weixin.qq.com/wework_admin/frame#index")
        cookies = [{'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.vst', 'path': '/', 'secure': False, 'value': '2eJMoGG6X-neAwBUa5OkdPWXRg93q0A_j7m5fUFUpY18UjYn8pSe5VVCM8Mfc0c6aSOJGGiUdVq_3SxIipZgAMtxrLvIZt68BvvnawRkIfgKdlI8MB63wtNZdSbEAn583d1Ba4pVALeo2fd8PyotQHT-BXw5Z30f4hseD3uwgBcXSzgvVe6rH-kASA0LqdXuPc76ma4w6QBCOU8yU9u8PcqHnK_PxHqNpKPFkwKwAetENQjGqL4Wg_6oL8qq87pQr6NP40claMCBMSdBCoraJA'}, {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.sid', 'path': '/', 'secure': False, 'value': '5SoOWhdBHQzlGpL8FA9hCZamzLX_HQULk9wJRPhn1YPVbGwjWEPrc2Dog-THZw45'}, {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wwrtx.d2st', 'path': '/', 'secure': False, 'value': 'a4293740'}, {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wwrtx.vid', 'path': '/', 'secure': False, 'value': '1688852949173043'}, {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wxpay.vid', 'path': '/', 'secure': False, 'value': '1688852949173043'}, {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wxpay.corpid', 'path': '/', 'secure': False, 'value': '1970325079158139'}, {'domain': '.work.weixin.qq.com', 'expiry': 1629551997, 'httpOnly': False, 'name': 'Hm_lvt_9364e629af24cb52acc78b43e8c9f77d', 'path': '/', 'secure': False, 'value': '1598015463'}, {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.ltype', 'path': '/', 'secure': False, 'value': '1'}, {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.ref', 'path': '/', 'secure': False, 'value': 'direct'}, {'domain': 'work.weixin.qq.com', 'expiry': 1598046989, 'httpOnly': True, 'name': 'ww_rtkey', 'path': '/', 'secure': False, 'value': 'gssdpk'}, {'domain': '.qq.com', 'expiry': 1598108677, 'httpOnly': False, 'name': '_gid', 'path': '/', 'secure': False, 'value': 'GA1.2.1465944454.1598015463'}, {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.refid', 'path': '/', 'secure': False, 'value': '2658621541755505'}, {'domain': '.qq.com', 'expiry': 1661094277, 'httpOnly': False, 'name': '_ga', 'path': '/', 'secure': False, 'value': 'GA1.2.641843878.1598015463'}, {'domain': '.work.weixin.qq.com', 'expiry': 1629551453, 'httpOnly': False, 'name': 'wwrtx.c_gdpr', 'path': '/', 'secure': False, 'value': '0'}, {'domain': '.work.weixin.qq.com', 'expiry': 1600614280, 'httpOnly': False, 'name': 'wwrtx.i18n_lan', 'path': '/', 'secure': False, 'value': 'zh-cn'}]

        for cookie in cookies:
            # 删除cookies里的expiry（有效期）-解决expiry的值若含有小数时导致用例执行失败的情况
            if 'expiry' in cookie.keys():
                cookie.pop('expiry')
            self.driver.add_cookie(cookie)

        sleep(3)
        self.driver.get("https://work.weixin.qq.com/wework_admin/frame#index")
        self.driver.find_element(By.ID, "menu_contacts").click()

    # shelve-对象持久化保存方式。可以将cookies保存在本地的某个文件或本地数据库，等
    def test_shelve(self):
        db = shelve.open("mydb/cookies")
        cookies = db['cookie']
        db.close()

        self.driver.get("https://work.weixin.qq.com/wework_admin/frame#index")
        for cookie in cookies:
            # 删除cookies里的expiry（有效期）-解决expiry的值若含有小数时导致用例执行失败的情况
            if 'expiry' in cookie.keys():
                cookie.pop('expiry')
            self.driver.add_cookie(cookie)

        sleep(3)
        self.driver.get("https://work.weixin.qq.com/wework_admin/frame#index")
        self.driver.find_element(By.ID, "menu_contacts").click()